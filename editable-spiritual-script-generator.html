<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚¹ãƒ”ãƒªãƒãƒ¥ã‚¢ãƒ«YouTubeå°æœ¬ç”Ÿæˆãƒ„ãƒ¼ãƒ«</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 40px;
        }

        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2em;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 40px;
            font-size: 0.9em;
        }

        .step-section {
            margin-bottom: 30px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 12px;
            border-left: 4px solid #667eea;
        }

        .step-title {
            font-size: 1.3em;
            color: #333;
            margin-bottom: 15px;
            font-weight: 600;
        }

        .step-description {
            color: #666;
            margin-bottom: 15px;
            line-height: 1.6;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 1em;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            font-weight: 600;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.4);
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .secondary-btn {
            background: #6c757d;
        }

        .secondary-btn:hover {
            box-shadow: 0 10px 25px rgba(108, 117, 125, 0.4);
        }

        .success-btn {
            background: #28a745;
        }

        .success-btn:hover {
            box-shadow: 0 10px 25px rgba(40, 167, 69, 0.4);
        }

        .theme-display {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .theme-editor {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            align-items: flex-start;
        }

        .theme-input {
            flex: 1;
            padding: 12px;
            border: 2px solid #667eea;
            border-radius: 8px;
            font-size: 1em;
            resize: vertical;
            min-height: 60px;
            width: 100%;
            font-family: inherit;
        }

        .theme-consultation {
            margin-bottom: 15px;
        }

        .theme-consultation label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-size: 0.95em;
        }

        .output-box {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-top: 15px;
            white-space: pre-wrap;
            line-height: 1.8;
            max-height: 400px;
            overflow-y: auto;
            font-size: 0.95em;
            border: 1px solid #e0e0e0;
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #667eea;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .progress-indicator {
            background: #e0e0e0;
            border-radius: 10px;
            height: 8px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress-fill {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            height: 100%;
            width: 0%;
            transition: width 0.3s;
        }

        .progress-text {
            text-align: center;
            color: #666;
            margin-top: 10px;
            font-size: 0.9em;
            font-weight: 600;
        }

        .chapter-list {
            margin-top: 15px;
        }

        .chapter-item {
            background: #f8f9fa;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 4px solid #ccc;
        }

        .chapter-item.complete {
            border-left-color: #28a745;
            background: #e6f7e6;
        }

        .chapter-item.processing {
            border-left-color: #ffc107;
            background: #fff9e6;
        }

        .final-script-area {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 12px;
            margin-top: 20px;
            white-space: pre-wrap;
            line-height: 1.8;
            max-height: 600px;
            overflow-y: auto;
            border: 1px solid #e0e0e0;
        }

        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .hidden {
            display: none;
        }

        .theme-count {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
            margin-left: 10px;
        }

        .completed-themes {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .completed-item {
            padding: 10px;
            margin-bottom: 8px;
            background: #e6f7e6;
            border-radius: 6px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 4px solid #28a745;
        }

        .download-link {
            background: #667eea;
            color: white;
            padding: 6px 15px;
            border-radius: 6px;
            text-decoration: none;
            font-size: 0.9em;
            cursor: pointer;
        }

        .download-link:hover {
            background: #5568d3;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸŒŸ ã‚¹ãƒ”ãƒªãƒãƒ¥ã‚¢ãƒ«YouTubeå°æœ¬ç”Ÿæˆãƒ„ãƒ¼ãƒ«</h1>
        <p class="subtitle">ãƒ†ãƒ¼ãƒã‚’1ã¤ãšã¤ç”Ÿæˆãƒ»ç·¨é›†ã—ã¦å®Œæˆå°æœ¬ã‚’ä½œæˆ</p>

        <!-- ã‚¹ãƒ†ãƒƒãƒ—1: ãƒ†ãƒ¼ãƒç”Ÿæˆ -->
        <div class="step-section">
            <div class="step-title">â‘  ãƒ†ãƒ¼ãƒã‚’ç”Ÿæˆãƒ»ç›¸è«‡</div>
            <div class="step-description">YouTubeã§å®Ÿéš›ã«äººæ°—ã®ã‚¹ãƒ”ãƒªãƒãƒ¥ã‚¢ãƒ«ç³»å‹•ç”»ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’åˆ†æã—ã€ã‚µãƒ³ãƒ—ãƒ«ãƒ†ãƒ¼ãƒã‚’ææ¡ˆã—ã¾ã™ã€‚æ°—ã«å…¥ã‚‰ãªã‘ã‚Œã°ä¿®æ­£ã‚’ç›¸è«‡ã§ãã¾ã™ã€‚</div>
            
            <div class="button-group">
                <button id="generateSampleBtn">ğŸ“Š YouTubeãƒªã‚µãƒ¼ãƒã—ã¦æœ€é©ãªãƒ†ãƒ¼ãƒã‚’ææ¡ˆ</button>
            </div>
            
            <div id="researchLoading" class="loading hidden">
                <div class="spinner"></div>
                <p>YouTubeã®äººæ°—å‹•ç”»ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’åˆ†æä¸­...</p>
            </div>
            
            <div id="researchResult" class="output-box hidden" style="background: #fff9e6; border: 2px solid #ffc107;">
                <strong>ğŸ“Š YouTubeãƒªã‚µãƒ¼ãƒçµæœ:</strong>
                <div id="researchContent" style="margin-top: 10px;"></div>
            </div>

            <div id="themeDisplay" class="theme-display hidden">
                <strong>ğŸ’¡ ææ¡ˆã•ã‚ŒãŸãƒ†ãƒ¼ãƒ:</strong>
                <div class="theme-editor">
                    <textarea id="themeInput" class="theme-input" placeholder="ãƒ†ãƒ¼ãƒã‚’ç·¨é›†ã§ãã¾ã™"></textarea>
                    <div class="button-group" style="flex-direction: column;">
                        <button id="acceptThemeBtn" class="success-btn">âœ… ã“ã®ãƒ†ãƒ¼ãƒã§å°æœ¬ä½œæˆ</button>
                        <button id="reviseThemeBtn" class="secondary-btn">ğŸ”„ ä¿®æ­£ã‚’ç›¸è«‡</button>
                        <button id="regenerateThemeBtn" class="secondary-btn">ğŸ”ƒ åˆ¥ã®æ¡ˆã‚’ææ¡ˆã—ã¦ã‚‚ã‚‰ã†</button>
                    </div>
                </div>
                
                <div id="revisionConsultation" class="hidden" style="margin-top: 20px; padding: 20px; background: #f0f8ff; border-radius: 8px; border: 2px solid #667eea;">
                    <label for="revisionInput"><strong>ã©ã†ä¿®æ­£ã—ãŸã„ã‹ç›¸è«‡:</strong></label>
                    <textarea id="revisionInput" class="theme-input" placeholder="ä¿®æ­£ã—ãŸã„ãƒã‚¤ãƒ³ãƒˆã‚’å…·ä½“çš„ã«æ›¸ã„ã¦ãã ã•ã„ã€‚ä¾‹ï¼š

ãƒ»ã‚‚ã£ã¨å…·ä½“çš„ã«ã—ã¦
ãƒ»æ•°å­—ã‚’å…¥ã‚Œã¦æ¬²ã—ã„ï¼ˆä¾‹ï¼š7ã¤ã®ã€3åˆ†ã§ã€ãªã©ï¼‰
ãƒ»å±æ©Ÿæ„Ÿã‚’å¼·ã‚ã¦
ãƒ»åˆå¿ƒè€…å‘ã‘ã®è¡¨ç¾ã«ã—ã¦
ãƒ»è¨ºæ–­å‹ã®ã‚¿ã‚¤ãƒˆãƒ«ã«ã—ã¦
ãƒ»YouTubeã§æ¤œç´¢ã•ã‚Œã‚„ã™ã„ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥ã‚Œã¦"></textarea>
                    <button id="submitRevisionBtn">ä¿®æ­£æ¡ˆã‚’ç”Ÿæˆ</button>
                    <button id="cancelRevisionBtn" class="secondary-btn">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
                </div>
            </div>
            
            <div id="conversationHistory" class="output-box hidden" style="background: #f0f8ff; border: 1px solid #667eea; max-height: 300px;">
                <strong>ğŸ’¬ ç›¸è«‡å±¥æ­´:</strong>
                <div id="conversationLog" style="margin-top: 10px;"></div>
            </div>
        </div>

        <!-- ã‚¹ãƒ†ãƒƒãƒ—2: æ§‹æˆç”Ÿæˆ -->
        <div class="step-section">
            <div class="step-title">â‘¡ 8ç« æ§‹æˆã‚’ä½œæˆ</div>
            <div class="step-description">é¸æŠã—ãŸãƒ†ãƒ¼ãƒã§8ç« æ§‹æˆã‚’è‡ªå‹•ä½œæˆã—ã¾ã™</div>
            
            <div id="structureLoading" class="loading hidden">
                <div class="spinner"></div>
                <p>æ§‹æˆã‚’ä½œæˆä¸­...</p>
            </div>

            <div id="structureDisplay" class="output-box hidden"></div>
        </div>

        <!-- ã‚¹ãƒ†ãƒƒãƒ—3: å„ç« ç”Ÿæˆ -->
        <div class="step-section">
            <div class="step-title">â‘¢ å…¨8ç« ã®æœ¬æ–‡ã‚’ç”Ÿæˆ</div>
            <div class="step-description">ç¬¬1ç« ã‹ã‚‰æœ€çµ‚ç« ã¾ã§é †ç•ªã«ç”Ÿæˆã—ã¾ã™ï¼ˆå„ç« 1200-1500æ–‡å­—ï¼‰</div>
            
            <div class="progress-indicator">
                <div id="chapterProgress" class="progress-fill"></div>
            </div>
            <div id="chapterProgressText" class="progress-text"></div>

            <div id="chapterLoading" class="loading hidden">
                <div class="spinner"></div>
                <p>ç« ã‚’ç”Ÿæˆä¸­...</p>
            </div>

            <div id="chapterList" class="chapter-list"></div>
        </div>

        <!-- ã‚¹ãƒ†ãƒƒãƒ—4: å®Œæˆå°æœ¬ -->
        <div class="step-section">
            <div class="step-title">â‘£ å®Œæˆå°æœ¬</div>
            <div class="step-description">ç”Ÿæˆã•ã‚ŒãŸå®Œæˆå°æœ¬ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã¾ã™</div>
            
            <div id="finalScriptContainer" class="hidden">
                <div class="button-group">
                    <button id="downloadBtn" class="success-btn">ğŸ“¥ å°æœ¬ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
                    <button id="copyBtn" class="secondary-btn">ğŸ“‹ å°æœ¬ã‚’ã‚³ãƒ”ãƒ¼</button>
                    <button id="nextThemeBtn">æ¬¡ã®ãƒ†ãƒ¼ãƒã‚’ä½œæˆ</button>
                </div>
                <div id="finalScript" class="final-script-area"></div>
            </div>
        </div>

        <!-- å®Œæˆãƒªã‚¹ãƒˆ -->
        <div class="step-section" id="completedSection" style="display: none;">
            <div class="step-title">âœ… å®Œæˆã—ãŸå°æœ¬ä¸€è¦§</div>
            <div id="completedList" class="completed-themes"></div>
            <button id="downloadAllBtn" class="success-btn">ğŸ“¦ å…¨å°æœ¬ã‚’ã¾ã¨ã‚ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
        </div>
    </div>

    <script>
        const CTA_FIRST = `æ—©é€Ÿå§‹ã‚ã‚‹å‰ã«ã€10ç§’ã ã‘ãŠæ™‚é–“ã‚’ãã ã•ã„ã€‚
ãƒãƒ£ãƒãƒªãƒ³ã‚°ã‚„ãƒãƒ£ã‚¯ãƒ©ã€ã‚ªãƒ¼ãƒ©ã‚„ãƒ’ãƒ¼ãƒªãƒ³ã‚°â€¦
ãã†ã„ã£ãŸã‚¹ãƒ”ãƒªãƒãƒ¥ã‚¢ãƒ«ãªå­¦ã³ã«æƒ¹ã‹ã‚Œã€å‹‰å¼·ã—ã¦ããŸã®ã«â€•â€•
âœ”ã€Œã‚„ã£ã¦ã‚‚ä½“æ„ŸãŒãªã„ã€
âœ”ã€Œè‡ªä¿¡ã‚’æŒã£ã¦äººã‚’ç™’ã›ãªã„ã€
âœ”ã€Œçµå±€ã€æ¬¡ã®æ•™æã‚„è¬›åº§ã‚’æ¢ã—ã¦ã—ã¾ã†ã€
ãã‚“ãªãµã†ã«æ„Ÿã˜ã¦ã„ã¾ã›ã‚“ã‹ï¼Ÿ
æœ¬ã‚„å‹•ç”»ã‚’è¦‹ã¦ã‚‚ã€ã„ã–å®Ÿè·µã™ã‚‹ã¨
ã€Œãƒ’ãƒ¼ãƒªãƒ³ã‚°ã¯æœ¬å½“ã«ã§ãã¦ã„ã‚‹ã®ã‹ï¼Ÿã€
ã€Œãƒãƒ£ã‚¯ãƒ©ã¯é–‹ã„ã¦ã„ã‚‹ã®ã‹ï¼Ÿã€
ã€Œã‚ªãƒ¼ãƒ©ã‚’æ„Ÿã˜ã‚‰ã‚Œã¦ã„ã‚‹ã®ã‹ï¼Ÿã€
ã¨ä¸å®‰ã«ãªã‚Šã€æ°—ã¥ã‘ã°ã¾ãŸæ¬¡ã®æ•™æã‚’æ¢ã—ã¦ã—ã¾ã†â€¦ã€‚
ãã‚“ãª"ã‚¹ãƒ”ãƒªãƒãƒ¥ã‚¢ãƒ«ç¿’å¾—è¿·å­"ã®æ–¹ã®ãŸã‚ã«ã€ä»ŠLINEã§
ğŸŒŸã€ãƒ’ãƒ¼ãƒªãƒ³ã‚°ã‚„ãƒãƒ£ãƒãƒªãƒ³ã‚°ã‚’ã‚¼ãƒ­ã‹ã‚‰ä½“æ„Ÿã§ãã‚‹ç„¡æ–™ä½“é¨“ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã€‘
ğŸŒŸã€ãƒãƒ£ã‚¯ãƒ©ã¨ã‚ªãƒ¼ãƒ©ã‚’å®‰å®šçš„ã«æ•´ãˆã‚‹ç§˜ä¼ã®å®Ÿè·µæ³•ã€‘
ã‚’ç‰¹åˆ¥ã«ãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆã—ã¦ã„ã¾ã™ã€‚
ã—ã‹ã‚‚ã€ã“ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¯ ã‚¹ãƒãƒ›ã•ãˆã‚ã‚Œã°ã€ã©ã“ã§ã‚‚å­¦ã¹ã‚‹ å½¢ã«ãªã£ã¦ã„ã¾ã™ã€‚
ã¡ã‚‡ã£ã¨ã—ãŸã‚¹ã‚­ãƒæ™‚é–“ã§ã‚‚å–ã‚Šçµ„ã‚ã‚‹ã®ã§ã€å¿™ã—ã„æ–¹ã§ã‚‚ç„¡ç†ãªãå®Ÿè·µã§ãã¾ã™ã€‚
ã•ã‚‰ã«ã€ç§è‡ªèº«ãŒã“ã‚Œã¾ã§ å»¶ã¹4ä¸‡5,000äººä»¥ä¸Šã«æ–½è¡“ãƒ»æŒ‡å°ã—ã¦ããŸå®Ÿä½“é¨“ã‚’ã‚‚ã¨ã«ã—ãŸå†…å®¹ ãªã®ã§ã€ä»–ã§ã¯èã‘ãªã„"ç¾å ´ã§çµæœãŒå‡ºãŸã‚¨ãƒãƒ«ã‚®ãƒ¼æ³•å‰‡"ã‚’å­¦ã¶ã“ã¨ãŒã§ãã¾ã™ã€‚
ãŸã£ãŸ10ç§’ã®è¡Œå‹•ã§ã¯ç¾å®Ÿã¯å¤‰ã‚ã‚Šã¾ã›ã‚“ã€‚
ã§ã™ãŒã€ãã®æœ€åˆã®10ç§’ã§å‹•ã„ãŸäººã¯ã™ã§ã«â€•â€•
âœ¨ã€Œã‚¬ã‚¤ãƒ‰ã¨ç¢ºä¿¡ã‚’æŒã£ã¦ã¤ãªãŒã‚Œã‚‹ãƒãƒ£ãƒãƒªãƒ³ã‚°åŠ›ã€
âœ¨ã€Œãƒãƒ£ã‚¯ãƒ©ã‚„ã‚ªãƒ¼ãƒ©ã‚’èª¿å¾‹ã—ã€æ³¢å‹•ã‚’è‡ªåœ¨ã«æ‰±ã†åŠ›ã€
âœ¨ã€Œäººç”Ÿã‚’å¥½è»¢ã•ã›ã‚‹ã‚¨ãƒãƒ«ã‚®ãƒ¼ã®ãƒã‚¹ã‚¿ãƒ¼æ³•å‰‡ã€
ã‚’æ‰‹ã«å…¥ã‚Œå§‹ã‚ã¦ã„ã¾ã™ã€‚
è¿·ã‚ãšã€ä»Šã™ããã®æŒ‡ã§æ¦‚è¦æ¬„ã‹ã‚‰LINEã«ç„¡æ–™ç™»éŒ²ã—ã¦ãã ã•ã„ã€‚
ã‚ãªãŸã®"æœ¬æ¥ã®åŠ›"ã‚’å‘¼ã³è¦šã¾ã™ç¬¬ä¸€æ­©ã‚’ã€ä»Šã“ã“ã‹ã‚‰è¸ã¿å‡ºã—ã¾ã—ã‚‡ã†ã€‚`;

        const CTA_FINAL = `æœ€å¾Œã¾ã§ã”è¦–è´ã„ãŸã ãã¾ã—ã¦ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚
ãœã²ã€ã‚ãªãŸã‚‚ç§˜ä¼ã®ç†è«–ã‚’å­¦ã³ç¢ºå®Ÿã«äººã‚’ç™’ã›ã‚‹ãƒ’ãƒ¼ãƒ©ãƒ¼ã«ãªã‚Šã¾ã›ã‚“ã‹?
ç§ã®å…¬å¼LINEã§ã¯ã€ã¾ã£ãŸããƒ’ãƒ¼ãƒªãƒ³ã‚°ã®ä½“æ„ŸãŒãªã„æ–¹ã§ã‚‚ãƒ’ãƒ¼ãƒªãƒ³ã‚°èƒ½åŠ›ã‚’è¦šé†’ã•ã›ã¦ã€ä¸Šé”ã™ã‚‹ãŸã‚ã®æ¬¡å…ƒä¸Šæ˜‡ã‚»ãƒ«ãƒ•ãƒ’ãƒ¼ãƒªãƒ³ã‚°ã®å¥¥ç¾©ã‚’5æœ¬ã®å‹•ç”»ã§ãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆã—ã¦ã„ã¾ã™ã€‚
âœ… ç´¯è¨ˆ4ä¸‡5000äººä»¥ä¸Šã‚’æ–½è¡“æŒ‡å°ã—ã¦ã‚ã‹ã£ãŸ
ã€€"ç™’ã—ãŒèµ·ã“ã‚‹å®‡å®™ã®ä»•çµ„ã¿"ã‚’å¾¹åº•è§£èª¬ã—ãŸå‹•ç”»ã‚³ãƒ³ãƒ†ãƒ³ãƒ„
âœ… ãŸã£ãŸ3åˆ†ã®æ°£ã®ä¼æˆã§
ã€€æ–½è¡“åŠ›ãŒä¸€æ°—ã«å¼•ãä¸ŠãŒã‚‹ã€å®‡å®™ç§˜ä¼åŠŸã®ã‚¹ãƒ†ãƒƒãƒ—ã€‘
âœ… åˆå¿ƒè€…ã§ã‚‚"æ°£"ã‚’ãƒªã‚¢ãƒ«ã«æ„Ÿã˜ã‚‰ã‚Œã‚‹
ã€€èº«ä½“ã®"ã‚ã‚‹ãƒã‚¤ãƒ³ãƒˆ"ã¨è¦šé†’ãƒ¯ãƒ¼ã‚¯
âœ… ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã§ã‚‚ã‚¨ãƒãƒ«ã‚®ãƒ¼é€šã‚‹
ã€€9å‰²ãŒçŸ¥ã‚‰ãªã„"æ°£"ã®æœ¬å½“ã®ä½¿ã„æ–¹ã¨ã¯
âœ… å®Ÿéš›ã«å¹´å•†10å€ã‚’å¶ãˆãŸ
ã€€ãƒ’ãƒ¼ãƒ©ãƒ¼ãƒ»æ•´ä½“å¸«ã®ãƒªã‚¢ãƒ«ä½“é¨“è«‡ã¨ãã®æ–¹æ³•
ãªã©
ğŸŒ€ã€Œã‚¹ãƒ”ãƒªãƒãƒ¥ã‚¢ãƒ«ãªã“ã¨ã«èˆˆå‘³ã‚ã‚‹ã‘ã©ã€ã‚ˆãã‚ã‹ã‚‰ãªã„â€¦ã€
ğŸŒˆã€Œæœ¬å½“ã«"è‡ªåˆ†ã«ã‚‚"ãƒ’ãƒ¼ãƒªãƒ³ã‚°ãŒã§ãã‚‹ã®ï¼Ÿã€
ã¨æ€ã†æ–¹ã‚‚ã€å‹•ç”»ã‚’è¦‹ãŸã‚ã¨ã«ã¯ä¸æ€è­°ã¨"ç¢ºä¿¡"ã«å¤‰ã‚ã£ã¦ã„ãã¾ã™ã€‚
ğŸŒŸãŸã¨ãˆéœŠæ„ŸãŒãªãã¦ã‚‚å¤§ä¸ˆå¤«
è¦‹ã¦ã€æ„Ÿã˜ã¦ã€ãƒãƒã™ã‚‹ã ã‘ã§ã€
ã‚ãªãŸã®ä¸­ã®"çœ ã‚Œã‚‹åŠ›"ãŒã€è‡ªç„¶ã«ç›®è¦šã‚å§‹ã‚ã‚‹ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã§ã™ã€‚
ã“ã‚Œã¾ã§æ•°åƒä¸‡å††ä»¥ä¸Šã®æŠ•è³‡ã‚’ã—ã¦å­¦ã‚“ã§ããŸä¾¡å€¤ãŒé«˜ã„å†…å®¹ã§ã€éå¸¸ã«å¥½è©•ãªã‚‚ã®ã¨ãªã‚‹ã®ã§ã€ãœã²æ¦‚è¦æ¬„ã®ãƒšãƒ¼ã‚¸ã‹ã‚‰ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã¦ã€å…¬å¼LINEã‚’ç™»éŒ²ã—ã¦ã¿ã¦ãã ã•ã„ã€‚
ã¾ãŸã€ãƒ’ãƒ¼ãƒªãƒ³ã‚°ã‚„ã‚¹ãƒ”ãƒªãƒãƒ¥ã‚¢ãƒ«ã®ç¿’å¾—ã‚’æœ€é€Ÿã§ç›®æŒ‡ã›ã‚‹ä½“é¨“ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚‚ã”æ¡ˆå†…ã—ã¦ã„ã‚‹ã®ã§ã€ãã¡ã‚‰ã‚‚ãƒã‚§ãƒƒã‚¯ã—ã¦ã„ãŸã ã‘ã‚‹ã¨å¬‰ã—ã„ã§ã™ã€‚
LINEã«ã”ç™»éŒ²ã„ãŸã ãã¨ã€ã©ãªãŸã§ã‚‚å—ã‘å–ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
æ˜¯éã“ã®å‹•ç”»ã®æ¦‚è¦æ¬„ã‹ã‚‰ LINEã®URLã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ã¿ã¦ãã ã•ã„ã­ã€‚
ä»Šå›ã‚‚ã“ã“ã¾ã§ã”è¦§ã„ãŸã ãã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸã€‚

ä»Šå¾Œã‚ˆã‚Šå„ªã‚ŒãŸæƒ…å ±ã‚’å³é¸ã—ã¦ã€ãŠå±Šã‘ã™ã‚‹ãŸã‚ã«ã‚‚GOODãƒœã‚¿ãƒ³ã‚„ã‚³ãƒ¡ãƒ³ãƒˆã‚’ã„ãŸã ã‘ãŸã‚‰ã†ã‚Œã—ã„ã§ã™ã€‚

ãã—ã¦ã€æ¬¡å›ã®å‹•ç”»ã‚‚æ¿ƒã„æƒ…å ±ã‚’ãŠå±Šã‘ã—ã¾ã™ã€‚

é€šçŸ¥ã‚’è¦‹é€ƒã•ãªã„ã‚ˆã†ã«ãƒãƒ£ãƒ³ãƒãƒ«ã‚‚ã‚ˆã‚ã—ããŠé¡˜ã„ã—ã¾ã™ã€‚
ãã‚Œã§ã¯ã¾ãŸãŠä¼šã„ã—ã¾ã—ã‚‡ã†!`;

        let currentTheme = '';
        let currentStructure = '';
        let currentChapters = [];
        let currentChapterTitles = [];
        let currentFinalScript = '';
        let completedScripts = [];
        let conversationHistory = [];
        let researchData = '';

        // YouTubeãƒªã‚µãƒ¼ãƒã—ã¦ãƒ†ãƒ¼ãƒææ¡ˆ
        document.getElementById('generateSampleBtn').addEventListener('click', generateThemeWithResearch);
        document.getElementById('regenerateThemeBtn').addEventListener('click', generateThemeWithResearch);
        
        // ä¿®æ­£ç›¸è«‡ãƒœã‚¿ãƒ³
        document.getElementById('reviseThemeBtn').addEventListener('click', () => {
            const revisionSection = document.getElementById('revisionConsultation');
            revisionSection.classList.remove('hidden');
        });
        
        // ä¿®æ­£ã‚­ãƒ£ãƒ³ã‚»ãƒ«
        document.getElementById('cancelRevisionBtn').addEventListener('click', () => {
            document.getElementById('revisionConsultation').classList.add('hidden');
            document.getElementById('revisionInput').value = '';
        });
        
        // ä¿®æ­£æ¡ˆç”Ÿæˆ
        document.getElementById('submitRevisionBtn').addEventListener('click', async () => {
            const currentThemeText = document.getElementById('themeInput').value.trim();
            const revisionRequest = document.getElementById('revisionInput').value.trim();
            
            if (!currentThemeText || !revisionRequest) {
                alert('ç¾åœ¨ã®ãƒ†ãƒ¼ãƒã¨ä¿®æ­£å†…å®¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            const loading = document.getElementById('researchLoading');
            const submitBtn = document.getElementById('submitRevisionBtn');
            
            submitBtn.disabled = true;
            loading.classList.remove('hidden');
            document.getElementById('researchLoading').querySelector('p').textContent = 'ä¿®æ­£æ¡ˆã‚’ç”Ÿæˆä¸­...';
            
            try {
                const prompt = `ä»¥ä¸‹ã®YouTubeãƒªã‚µãƒ¼ãƒãƒ‡ãƒ¼ã‚¿ã‚’å‚è€ƒã«ã—ã¦ãã ã•ã„ï¼š
${researchData}

ç¾åœ¨ã®ãƒ†ãƒ¼ãƒï¼šã€Œ${currentThemeText}ã€

ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®ä¿®æ­£è¦æœ›ï¼š
${revisionRequest}

ä¸Šè¨˜ã®ä¿®æ­£è¦æœ›ã‚’åæ˜ ã—ã¦ã€YouTubeã§å®Ÿéš›ã«ãƒ’ãƒƒãƒˆã™ã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ´»ç”¨ã—ãŸæ”¹å–„ãƒ†ãƒ¼ãƒã‚’1ã¤ææ¡ˆã—ã¦ãã ã•ã„ã€‚

ãƒ»å…·ä½“çš„
ãƒ»è¨ºæ–­å‹ or æ•°å­—å…¥ã‚Š or å±æ©Ÿæ„Ÿã‚ã‚Š
ãƒ»æŠ½è±¡ç¦æ­¢
ãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è¦æœ›ã‚’å¿…ãšåæ˜ ã™ã‚‹ã“ã¨
ãƒ»YouTubeã§äººæ°—ãŒå‡ºã‚„ã™ã„è¦ç´ ã‚’å«ã‚ã‚‹ã“ã¨

ã‚¿ã‚¤ãƒˆãƒ«ã®ã¿å‡ºåŠ›ï¼ˆç•ªå·ä¸è¦ã€èª¬æ˜ä¸è¦ï¼‰`;

                const revisedTheme = await callClaude(prompt);
                currentTheme = revisedTheme.trim();
                
                document.getElementById('themeInput').value = currentTheme;
                
                // ç›¸è«‡å±¥æ­´ã«è¿½åŠ 
                addToConversationLog('ã‚ãªãŸã®ä¿®æ­£è¦æœ›', revisionRequest);
                addToConversationLog('AIã®ä¿®æ­£æ¡ˆ', currentTheme);
                
                document.getElementById('revisionInput').value = '';
                document.getElementById('revisionConsultation').classList.add('hidden');
                
            } catch (error) {
                alert('ã‚¨ãƒ©ãƒ¼: ' + error.message);
            } finally {
                submitBtn.disabled = false;
                loading.classList.add('hidden');
                document.getElementById('researchLoading').querySelector('p').textContent = 'YouTubeã®äººæ°—å‹•ç”»ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’åˆ†æä¸­...';
            }
        });

        async function generateThemeWithResearch() {
            const loading = document.getElementById('researchLoading');
            const researchResult = document.getElementById('researchResult');
            const researchContent = document.getElementById('researchContent');
            const display = document.getElementById('themeDisplay');
            const generateBtn = document.getElementById('generateSampleBtn');
            const regenerateBtn = document.getElementById('regenerateThemeBtn');

            generateBtn.disabled = true;
            regenerateBtn.disabled = true;
            loading.classList.remove('hidden');
            researchResult.classList.add('hidden');
            display.classList.add('hidden');

            try {
                // ã‚¹ãƒ†ãƒƒãƒ—1: YouTubeãƒªã‚µãƒ¼ãƒï¼ˆAIã«YouTubeã®äººæ°—ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ¨æ¸¬ã•ã›ã‚‹ï¼‰
                const researchPrompt = `ã‚ãªãŸã¯YouTubeã‚¹ãƒ”ãƒªãƒãƒ¥ã‚¢ãƒ«ã‚¸ãƒ£ãƒ³ãƒ«ã®å°‚é–€å®¶ã§ã™ã€‚

ã€Œãƒ’ãƒ¼ãƒªãƒ³ã‚°ã€ã€Œæ³¢å‹•ã€ã€Œè¦šé†’ã€ã€Œãƒãƒ£ã‚¯ãƒ©ã€ã€Œå¼•ãå¯„ã›ã€ãªã©ã®ã‚¹ãƒ”ãƒªãƒãƒ¥ã‚¢ãƒ«ç³»å‹•ç”»ã§ã€
YouTubeã§å®Ÿéš›ã«å†ç”Ÿæ•°ãŒä¼¸ã³ã‚„ã™ã„å‹•ç”»ã‚¿ã‚¤ãƒˆãƒ«ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’åˆ†æã—ã¦ãã ã•ã„ã€‚

ä»¥ä¸‹ã®è¦³ç‚¹ã§åˆ†æçµæœã‚’200æ–‡å­—ç¨‹åº¦ã§ç°¡æ½”ã«ã¾ã¨ã‚ã¦ãã ã•ã„ï¼š
ãƒ»ã©ã‚“ãªã‚¿ã‚¤ãƒˆãƒ«å½¢å¼ãŒäººæ°—ã‹ï¼ˆè¨ºæ–­å‹ã€æ•°å­—å…¥ã‚Šã€å±æ©Ÿæ„Ÿå‹ãªã©ï¼‰
ãƒ»ã©ã‚“ãªã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãŒåŠ¹æœçš„ã‹
ãƒ»åˆå¿ƒè€…ãŒå¼•ãè¾¼ã¾ã‚Œã‚„ã™ã„è¦ç´ ã¯ä½•ã‹

åˆ†æçµæœã®ã¿å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚`;

                researchData = await callClaude(researchPrompt);
                
                // ãƒªã‚µãƒ¼ãƒçµæœã‚’è¡¨ç¤º
                researchContent.textContent = researchData;
                researchResult.classList.remove('hidden');
                
                // ç›¸è«‡å±¥æ­´ã«è¿½åŠ 
                addToConversationLog('YouTubeãƒªã‚µãƒ¼ãƒåˆ†æ', researchData);

                // ã‚¹ãƒ†ãƒƒãƒ—2: ãƒªã‚µãƒ¼ãƒçµæœã‚’åŸºã«ãƒ†ãƒ¼ãƒç”Ÿæˆ
                loading.querySelector('p').textContent = 'æœ€é©ãªãƒ†ãƒ¼ãƒã‚’ææ¡ˆä¸­...';
                
                const themePrompt = `ä»¥ä¸‹ã®YouTubeãƒªã‚µãƒ¼ãƒåˆ†æçµæœã«åŸºã¥ã„ã¦ã€ãƒ†ãƒ¼ãƒã‚’1ã¤ææ¡ˆã—ã¦ãã ã•ã„ï¼š

${researchData}

åˆå¿ƒè€…å‘ã‘ãƒ’ãƒ¼ãƒªãƒ³ã‚°ãƒ»æ³¢å‹•ãƒ»è¦šé†’ã‚¸ãƒ£ãƒ³ãƒ«ã§ã€
ä¸Šè¨˜ã®åˆ†æã‚’è¸ã¾ãˆã¦ã€ã‚¯ãƒªãƒƒã‚¯ç‡ãŒé«˜ãé•·å°ºè§£èª¬ã«å‘ãå‹•ç”»ãƒ†ãƒ¼ãƒã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚

ãƒ»å…·ä½“çš„
ãƒ»è¨ºæ–­å‹ or æ•°å­—å…¥ã‚Š or å±æ©Ÿæ„Ÿã‚ã‚Š
ãƒ»æŠ½è±¡ç¦æ­¢
ãƒ»YouTubeã§å®Ÿéš›ã«ãƒ’ãƒƒãƒˆã—ã‚„ã™ã„è¦ç´ ã‚’å¿…ãšå«ã‚ã‚‹

ã‚¿ã‚¤ãƒˆãƒ«ã®ã¿å‡ºåŠ›ï¼ˆç•ªå·ä¸è¦ã€èª¬æ˜ä¸è¦ï¼‰`;

                const theme = await callClaude(themePrompt);
                currentTheme = theme.trim();
                
                document.getElementById('themeInput').value = currentTheme;
                display.classList.remove('hidden');
                
                // ç›¸è«‡å±¥æ­´ã«è¿½åŠ 
                addToConversationLog('AIã®ææ¡ˆãƒ†ãƒ¼ãƒ', currentTheme);

            } catch (error) {
                alert('ã‚¨ãƒ©ãƒ¼: ' + error.message);
            } finally {
                generateBtn.disabled = false;
                regenerateBtn.disabled = false;
                loading.classList.add('hidden');
                loading.querySelector('p').textContent = 'YouTubeã®äººæ°—å‹•ç”»ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’åˆ†æä¸­...';
            }
        }
        
        function addToConversationLog(speaker, message) {
            const log = document.getElementById('conversationLog');
            const history = document.getElementById('conversationHistory');
            
            const entry = document.createElement('div');
            entry.style.marginBottom = '15px';
            entry.style.padding = '12px';
            entry.style.borderRadius = '8px';
            entry.style.background = speaker.includes('AI') ? '#e8f4ff' : '#fff';
            entry.style.borderLeft = speaker.includes('AI') ? '3px solid #667eea' : '3px solid #28a745';
            
            const cleanMessage = message.replace(/^["']|["']$/g, '').trim();
            
            entry.innerHTML = `<strong style="color: #333;">${speaker}:</strong><br><span style="color: #555;">${cleanMessage}</span>`;
            
            log.appendChild(entry);
            history.classList.remove('hidden');
            
            // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
            setTimeout(() => {
                history.scrollTop = history.scrollHeight;
            }, 100);
        }

        // ãƒ†ãƒ¼ãƒç¢ºå®šã—ã¦å°æœ¬ä½œæˆé–‹å§‹
        document.getElementById('acceptThemeBtn').addEventListener('click', async () => {
            currentTheme = document.getElementById('themeInput').value.trim();
            
            if (!currentTheme) {
                alert('ãƒ†ãƒ¼ãƒã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }

            // UIã‚’ãƒªã‚»ãƒƒãƒˆ
            document.getElementById('themeDisplay').classList.add('hidden');
            document.getElementById('generateSampleBtn').disabled = true;
            document.getElementById('structureDisplay').classList.add('hidden');
            document.getElementById('chapterList').innerHTML = '';
            document.getElementById('finalScriptContainer').classList.add('hidden');
            
            currentChapters = [];
            currentChapterTitles = [];

            try {
                // æ§‹æˆç”Ÿæˆ
                await generateStructure();
                
                // å…¨ç« ç”Ÿæˆ
                await generateAllChapters();
                
                // æœ€çµ‚å°æœ¬ä½œæˆ
                createFinalScript();

            } catch (error) {
                alert('ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ' + error.message);
                document.getElementById('generateSampleBtn').disabled = false;
            }
        });

        async function generateStructure() {
            const loading = document.getElementById('structureLoading');
            const display = document.getElementById('structureDisplay');

            loading.classList.remove('hidden');

            try {
                const prompt = `ä»¥ä¸‹ãƒ†ãƒ¼ãƒã§YouTubeå‹•ç”»ã®æ§‹æˆã®ã¿ä½œã£ã¦ãã ã•ã„ã€‚

ãƒ†ãƒ¼ãƒï¼š
ã€Œ${currentTheme}ã€

ãƒ»8ç« æ§‹æˆ
ãƒ»å„ç« ã®å†…å®¹ã‚’100æ–‡å­—ã§è¦ç´„
ãƒ»æœ¬æ–‡ã¯ã¾ã æ›¸ã‹ãªã„`;

                console.log('æ§‹æˆç”Ÿæˆé–‹å§‹:', currentTheme);
                currentStructure = await callClaude(prompt);
                console.log('æ§‹æˆç”Ÿæˆå®Œäº†:', currentStructure);
                
                currentChapterTitles = extractChapterTitles(currentStructure);
                console.log('ç« ã‚¿ã‚¤ãƒˆãƒ«æŠ½å‡º:', currentChapterTitles);

                display.textContent = currentStructure;
                display.classList.remove('hidden');
                loading.classList.add('hidden');
            } catch (error) {
                loading.classList.add('hidden');
                console.error('æ§‹æˆç”Ÿæˆã‚¨ãƒ©ãƒ¼:', error);
                throw new Error('æ§‹æˆç”Ÿæˆã«å¤±æ•—ã—ã¾ã—ãŸ: ' + error.message);
            }
        }

        async function generateAllChapters() {
            const loading = document.getElementById('chapterLoading');
            const list = document.getElementById('chapterList');
            const progressFill = document.getElementById('chapterProgress');
            const progressText = document.getElementById('chapterProgressText');

            loading.classList.remove('hidden');

            // ç¬¬1ç« 
            updateChapterProgress(1, 8);
            addChapterItem(1, 'processing');

            const chapter1Prompt = `ç¬¬1ç« ã®ã¿æ›¸ã„ã¦ãã ã•ã„ã€‚

ãƒ†ãƒ¼ãƒ: ${currentTheme}

æ§‹æˆ:
${currentStructure}

ãƒ»1200ã€œ1500æ–‡å­—
ãƒ»åˆå¿ƒè€…å‘ã‘
ãƒ»æœ€åˆã®1æ–‡ã§å¼·ã„ãƒ•ãƒƒã‚¯ã‚’è‡ªå‹•ç”Ÿæˆ
ãƒ»å•é¡Œæèµ·ã®ãƒ¯ãƒ³ã‚»ãƒ³ãƒ†ãƒ³ã‚¹ã®å¾Œã«ä»¥ä¸‹ã®è‡ªå·±ç´¹ä»‹æ–‡ã‚’å…¥ã‚Œã‚‹
ã€Œã“ã‚“ã«ã¡ã¯ã€‚é éš”æ³¢å‹•ãƒ’ãƒ¼ãƒªãƒ³ã‚°å‰µå§‹è€…ã®ã¹ã£ã—ãƒ¼ã§ã™ã€‚ã€
ãƒ»ç« ã®æœ€å¾Œã«ä»¥ä¸‹ã®CTAã‚’ãã®ã¾ã¾æŒ¿å…¥

${CTA_FIRST}

ã€é‡è¦ï¼šå‰µä½œç¦æ­¢ãƒ«ãƒ¼ãƒ«ã€‘
ãƒ»æ¶ç©ºã®äººç‰©ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã€å—è¬›ç”Ÿã€ä½“é¨“è«‡ã€ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚’ä½œã‚‰ãªã„
ãƒ»ã€ŒAã•ã‚“ã€ã€Œã‚ã‚‹å¥³æ€§ã€ã€Œç§ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã€ãªã©ã®å‰µä½œäº‹ä¾‹ã¯ç¦æ­¢
ãƒ»å­˜åœ¨ã—ãªã„å®Ÿç¸¾ã‚„æ•°å­—ã‚’æé€ ã—ãªã„
ãƒ»å…·ä½“ä¾‹ã‚’æ›¸ãå ´åˆã¯ã€Œä¸€èˆ¬è«–ã€ã¾ãŸã¯ã€Œå¤šãã®äººã¯ã€œã€ã¨ã„ã†è¡¨ç¾ã®ã¿ä½¿ç”¨
ãƒ»äº‹å®Ÿãƒ»è§£èª¬ãƒ»æ™®éçš„èª¬æ˜ã ã‘ã§æ§‹æˆã™ã‚‹ã“ã¨
ãƒ»æ¬¡ã®ç« ã®äºˆå‘Šã¿ãŸã„ãªæ–‡ç« ã¯æ›¸ã‹ãªã„ã“ã¨`;

            const chapter1 = await callClaude(chapter1Prompt);
            currentChapters.push(chapter1);
            updateChapterItem(1, 'complete');

            // ç¬¬2-7ç« 
            for (let i = 2; i <= 7; i++) {
                updateChapterProgress(i, 8);
                addChapterItem(i, 'processing');

                const chapterPrompt = `ç¬¬${i}ç« ã®ã¿æ›¸ã„ã¦ãã ã•ã„ã€‚

ãƒ†ãƒ¼ãƒ: ${currentTheme}

æ§‹æˆ:
${currentStructure}

ã“ã‚Œã¾ã§ã®å†…å®¹:
${currentChapters.join('\n\n')}

ãƒ»1200ã€œ1500æ–‡å­—
ãƒ»ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ï¼‹è§£èª¬
ãƒ»CTAã¯å…¥ã‚Œãªã„
ãƒ»è‡ªç„¶ã«å‰ç« ã®ç¶šãã¨ã—ã¦æ›¸ã

ã€é‡è¦ï¼šå‰µä½œç¦æ­¢ãƒ«ãƒ¼ãƒ«ã€‘
ãƒ»ç« ã®æ›¸ãå‡ºã—ã‚’å®šå‹åŒ–ã—ãªã„ã§ãã ã•ã„ã€‚ç‰¹ã«ã€Œç¬¬1ç« ã§ãŠä¼ãˆã—ãŸé€šã‚Šã€ã¨ã„ã£ãŸæ—¢çŸ¥ã®äº‹å®Ÿã®å†ç¢ºèªã¯ä¸è¦ã§ã™ã€‚
ãƒ»æ¶ç©ºã®äººç‰©ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã€å—è¬›ç”Ÿã€ä½“é¨“è«‡ã€ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚’ä½œã‚‰ãªã„
ãƒ»ã€ŒAã•ã‚“ã€ã€Œã‚ã‚‹å¥³æ€§ã€ã€Œç§ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã€ãªã©ã®å‰µä½œäº‹ä¾‹ã¯ç¦æ­¢
ãƒ»å­˜åœ¨ã—ãªã„å®Ÿç¸¾ã‚„æ•°å­—ã‚’æé€ ã—ãªã„
ãƒ»å…·ä½“ä¾‹ã‚’æ›¸ãå ´åˆã¯ã€Œä¸€èˆ¬è«–ã€ã¾ãŸã¯ã€Œå¤šãã®äººã¯ã€œã€ã¨ã„ã†è¡¨ç¾ã®ã¿ä½¿ç”¨
ãƒ»äº‹å®Ÿãƒ»è§£èª¬ãƒ»æ™®éçš„èª¬æ˜ã ã‘ã§æ§‹æˆã™ã‚‹ã“ã¨
ãƒ»æ¬¡ã®ç« ã®äºˆå‘Šã¿ãŸã„ãªæ–‡ç« ã¯æ›¸ã‹ãªã„ã“ã¨`;

                const chapter = await callClaude(chapterPrompt);
                currentChapters.push(chapter);
                updateChapterItem(i, 'complete');
            }

            // ç¬¬8ç« ï¼ˆæœ€çµ‚ç« ï¼‰
            updateChapterProgress(8, 8);
            addChapterItem(8, 'processing');

            const finalChapterPrompt = `æœ€çµ‚ç« ã‚’æ›¸ã„ã¦ãã ã•ã„ã€‚

ãƒ†ãƒ¼ãƒ: ${currentTheme}

æ§‹æˆ:
${currentStructure}

ã“ã‚Œã¾ã§ã®å†…å®¹:
${currentChapters.join('\n\n')}

ãƒ»ã¾ã¨ã‚ï¼‹å¸Œæœ›
ãƒ»æœ€å¾Œã«ä»¥ä¸‹ã®CTAã‚’ãã®ã¾ã¾æŒ¿å…¥

${CTA_FINAL}

ã€é‡è¦ï¼šå‰µä½œç¦æ­¢ãƒ«ãƒ¼ãƒ«ã€‘
ãƒ»æ¶ç©ºã®äººç‰©ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã€å—è¬›ç”Ÿã€ä½“é¨“è«‡ã€ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚’ä½œã‚‰ãªã„
ãƒ»ã€ŒAã•ã‚“ã€ã€Œã‚ã‚‹å¥³æ€§ã€ã€Œç§ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã€ãªã©ã®å‰µä½œäº‹ä¾‹ã¯ç¦æ­¢
ãƒ»å­˜åœ¨ã—ãªã„å®Ÿç¸¾ã‚„æ•°å­—ã‚’æé€ ã—ãªã„
ãƒ»å…·ä½“ä¾‹ã‚’æ›¸ãå ´åˆã¯ã€Œä¸€èˆ¬è«–ã€ã¾ãŸã¯ã€Œå¤šãã®äººã¯ã€œã€ã¨ã„ã†è¡¨ç¾ã®ã¿ä½¿ç”¨
ãƒ»äº‹å®Ÿãƒ»è§£èª¬ãƒ»æ™®éçš„èª¬æ˜ã ã‘ã§æ§‹æˆã™ã‚‹ã“ã¨
ãƒ»æ¬¡ã®ç« ã®äºˆå‘Šã¿ãŸã„ãªæ–‡ç« ã¯æ›¸ã‹ãªã„ã“ã¨`;

            const finalChapter = await callClaude(finalChapterPrompt);
            currentChapters.push(finalChapter);
            updateChapterItem(8, 'complete');

            loading.classList.add('hidden');
        }

        function updateChapterProgress(current, total) {
            const percentage = (current / total) * 100;
            document.getElementById('chapterProgress').style.width = percentage + '%';
            document.getElementById('chapterProgressText').textContent = `ç¬¬${current}ç« ã‚’ç”Ÿæˆä¸­... (${current}/${total})`;
        }

        function addChapterItem(chapterNum, status) {
            const list = document.getElementById('chapterList');
            const item = document.createElement('div');
            item.id = 'chapter-item-' + chapterNum;
            item.className = 'chapter-item ' + status;
            item.innerHTML = `<strong>ç¬¬${chapterNum}ç« </strong> - ${status === 'processing' ? 'ç”Ÿæˆä¸­...' : 'å®Œäº†'}`;
            list.appendChild(item);
        }

        function updateChapterItem(chapterNum, status) {
            const item = document.getElementById('chapter-item-' + chapterNum);
            if (item) {
                item.className = 'chapter-item ' + status;
                item.innerHTML = `<strong>ç¬¬${chapterNum}ç« </strong> - ${status === 'complete' ? 'âœ… å®Œäº†' : 'ç”Ÿæˆä¸­...'}`;
            }
        }

        function createFinalScript() {
            let script = `${currentTheme}\n\n`;
            
            for (let i = 0; i < currentChapters.length; i++) {
                const chapterTitle = currentChapterTitles[i] || `ç¬¬${i + 1}ç« `;
                script += `${chapterTitle}\n\n${currentChapters[i]}\n\n\n`;
            }

            currentFinalScript = script;

            document.getElementById('finalScript').textContent = script;
            document.getElementById('finalScriptContainer').classList.remove('hidden');
            document.getElementById('chapterProgressText').textContent = 'å…¨8ç« ã®ç”ŸæˆãŒå®Œäº†ã—ã¾ã—ãŸï¼';
        }

        function extractChapterTitles(structureText) {
            const titles = [];
            const lines = structureText.split('\n');
            lines.forEach(line => {
                const match = line.match(/ç¬¬[1-8]ç« [ï¼š:](.*?)$/);
                if (match) {
                    titles.push(match[0].trim());
                }
            });
            return titles;
        }

        // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
        document.getElementById('downloadBtn').addEventListener('click', () => {
            downloadFile(currentTheme, currentFinalScript);
            saveCompletedScript();
        });

        // ã‚³ãƒ”ãƒ¼
        document.getElementById('copyBtn').addEventListener('click', () => {
            navigator.clipboard.writeText(currentFinalScript).then(() => {
                const btn = document.getElementById('copyBtn');
                const originalText = btn.textContent;
                btn.textContent = 'âœ… ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼';
                setTimeout(() => {
                    btn.textContent = originalText;
                }, 2000);
            });
        });

        // æ¬¡ã®ãƒ†ãƒ¼ãƒä½œæˆ
        document.getElementById('nextThemeBtn').addEventListener('click', () => {
            saveCompletedScript();
            resetForNewTheme();
        });

        function saveCompletedScript() {
            const exists = completedScripts.find(s => s.theme === currentTheme);
            if (!exists && currentFinalScript) {
                completedScripts.push({
                    theme: currentTheme,
                    content: currentFinalScript,
                    filename: `å°æœ¬_${completedScripts.length + 1}_${sanitizeFilename(currentTheme)}.txt`
                });
                updateCompletedList();
            }
        }

        function updateCompletedList() {
            if (completedScripts.length > 0) {
                document.getElementById('completedSection').style.display = 'block';
                
                const list = document.getElementById('completedList');
                list.innerHTML = '';
                
                completedScripts.forEach((script, index) => {
                    const item = document.createElement('div');
                    item.className = 'completed-item';
                    item.innerHTML = `
                        <span>${index + 1}. ${script.theme}</span>
                        <a class="download-link" onclick="downloadFileByIndex(${index})">ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</a>
                    `;
                    list.appendChild(item);
                });
            }
        }

        function resetForNewTheme() {
            document.getElementById('generateSampleBtn').disabled = false;
            document.getElementById('themeInput').value = '';
            document.getElementById('structureDisplay').classList.add('hidden');
            document.getElementById('chapterList').innerHTML = '';
            document.getElementById('finalScriptContainer').classList.add('hidden');
            document.getElementById('chapterProgress').style.width = '0%';
            document.getElementById('chapterProgressText').textContent = '';
            document.getElementById('conversationLog').innerHTML = '';
            document.getElementById('conversationHistory').classList.add('hidden');
            document.getElementById('revisionConsultation').classList.add('hidden');
            document.getElementById('researchResult').classList.add('hidden');
            document.getElementById('revisionInput').value = '';
            
            currentTheme = '';
            currentStructure = '';
            currentChapters = [];
            currentChapterTitles = [];
            currentFinalScript = '';
            conversationHistory = [];
            researchData = '';

            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // å…¨ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
        document.getElementById('downloadAllBtn').addEventListener('click', () => {
            completedScripts.forEach((script, index) => {
                setTimeout(() => {
                    const blob = new Blob([script.content], { type: 'text/plain;charset=utf-8' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = script.filename;
                    a.click();
                    URL.revokeObjectURL(url);
                }, index * 500);
            });
        });

        function downloadFile(theme, content) {
            const filename = `å°æœ¬_${sanitizeFilename(theme)}.txt`;
            const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            URL.revokeObjectURL(url);
        }

        window.downloadFileByIndex = function(index) {
            const script = completedScripts[index];
            const blob = new Blob([script.content], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = script.filename;
            a.click();
            URL.revokeObjectURL(url);
        };

        function sanitizeFilename(filename) {
            return filename
                .replace(/[<>:"\/\\|?*]/g, '')
                .replace(/\s+/g, '_')
                .substring(0, 50);
        }

        async function callClaude(prompt) {
            const response = await fetch('https://api.anthropic.com/v1/messages', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    model: 'claude-sonnet-4-20250514',
                    max_tokens: 4000,
                    messages: [{
                        role: 'user',
                        content: prompt
                    }]
                })
            });

            if (!response.ok) {
                throw new Error('APIå‘¼ã³å‡ºã—ã«å¤±æ•—ã—ã¾ã—ãŸ');
            }

            const data = await response.json();
            return data.content[0].text;
        }
    </script>
</body>
</html>